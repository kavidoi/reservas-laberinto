<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva de Experiencia - Vinos Laberinto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/fonts.css">
    </head>
<body>

    <div class="container mt-5 form-container">
        <div class="form-background"></div>
        <div class="form-content p-4 rounded shadow bg-light">

            <div class="text-center mb-4">
                <img src="images/logo-vinos-laberinto.png" alt="Logo Vinos Laberinto" class="form-logo">
            </div>

            <div id="step-q1GJ" class="form-step">
                <h2 class="love-font-title">Reserva de Experiencia</h2>
                <hr>

                <div id="widget-oY8v-container" class="mb-3">
                    <label for="widget-oY8v" class="form-label fw-bold"><h4>Experiencias grupales</h4></label>
                    <p class="form-text">Selecciona una de las experiencias grupales disponibles.</p>
                    <select class="form-select mb-2" id="widget-oY8v">
                        <option value="" selected disabled>Selecciona...</option>
                    </select>
                    {/* UPDATED onClick for Solicitar button */}
                    <button type="button" class="btn btn-secondary btn-sm" onclick="goToStep('step-request-start');">
                        Solicitar otra fecha
                    </button>
                 </div>

                <hr id="widget-2mrE">

                {/* ... rest of step q1GJ ... */}
                 <div class="form-check form-switch mb-3">...</div>
                 <div id="widget-3duJ-container" class="mb-3 d-none">...</div>
                 <div class="d-flex justify-content-end mt-4">...</div>
            </div>

            {/* --- NEW STEP: Request Date - Start --- */}
            <div id="step-request-start" class="form-step d-none">
                <h2>Solicitar Nueva Fecha Grupal</h2>
                <hr>
                <div class="mb-3">
                    <label for="request-experience-type" class="form-label fw-bold">Tipo de Experiencia Grupal</label>
                    <select class="form-select" id="request-experience-type" required>
                        <option value="" selected disabled>Cargando tipos...</option>
                        {/* Options populated by populateRequestExperienceTypes() */}
                    </select>
                    <div class="invalid-feedback">Por favor selecciona un tipo de experiencia.</div>
                </div>
                <div class="alert alert-secondary small">
                    <p class="mb-1"><strong>Reglas de Agendamiento Grupal:</strong></p>
                    <ul class="mb-0">
                        <li>Debe ser agendado para un <strong>Viernes, Sábado o Domingo</strong>.</li>
                        <li>Se requiere un mínimo de <strong>10 días de anticipación</strong>.</li>
                        <li>Horarios preferentes: Mañana (11:00-12:00), Tarde (15:00-16:00).</li>
                    </ul>
                </div>
                 <div class="d-flex justify-content-between mt-4">
                    {/* Go back to the main intro step */}
                    <button type="button" class="btn btn-outline-secondary" onclick="goToStep('step-q1GJ')">Cancelar Solicitud</button>
                    <button type="button" class="btn btn-primary" onclick="goToStep('step-request-select-datetime')">Seleccionar Fecha/Hora</button>
                </div>
            </div>

            {/* --- NEW STEP: Request Date - Select Date/Time --- */}
            <div id="step-request-select-datetime" class="form-step d-none">
                <h2>Seleccionar Fecha y Hora Sugerida</h2>
                <hr>
                 <div class="alert alert-info small">Por favor, selecciona una fecha (Viernes-Domingo, 10+ días desde hoy) y sugiere una hora de inicio (preferentemente 11-12 o 15-16).</div>
                 <div class="row g-3">
                    <div class="col-md-6 mb-3">
                        <label for="request-date" class="form-label fw-bold">Fecha Sugerida<span class="text-danger">*</span></label>
                        {/* Input will be enhanced by Flatpickr */}
                        <input type="text" class="form-control" id="request-date" placeholder="Selecciona una fecha..." required>
                         <div class="invalid-feedback">Por favor selecciona una fecha válida.</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="request-time" class="form-label fw-bold">Hora de Inicio Sugerida<span class="text-danger">*</span></label>
                        <input type="time" class="form-control" id="request-time" step="1800" required>
                        <small class="form-text text-muted">Incrementos de 30 min. Preferido: 11:00-12:00 o 15:00-16:00.</small>
                         <div class="invalid-feedback">Por favor selecciona una hora válida.</div>
                    </div>
                 </div>
                 {/* Optional: Add inputs for expected group size or comments specific to the request */}
                 <div class="mb-3">
                    <label for="request-contact-name" class="form-label fw-bold">Tu Nombre<span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="request-contact-name" required>
                 </div>
                  <div class="mb-3">
                    <label for="request-contact-email" class="form-label fw-bold">Tu Email<span class="text-danger">*</span></label>
                    <input type="email" class="form-control" id="request-contact-email" required>
                    <small class="form-text text-muted">Te contactaremos a este email para confirmar.</small>
                 </div>

                 {/* Placeholder for submission errors specific to this form */}
                 <div id="request-submission-error" class="alert alert-danger mt-3 d-none" role="alert"></div>

                 <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-outline-secondary" onclick="goBack()">Volver (Seleccionar Tipo)</button>
                    {/* Calls NEW submit function */}
                    <button type="button" class="btn btn-success" id="submit-request-button" onclick="submitDateRequest()">Enviar Solicitud de Fecha</button>
                </div>
            </div>

             {/* --- NEW STEP: Request Date - Confirmation --- */}
             <div id="step-request-confirm" class="form-step d-none">
                 <div class="text-center p-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-calendar-check text-success mb-3" viewBox="0 0 16 16">
                        <path d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                    </svg>
                    <h2>Solicitud Enviada</h2>
                    <p>Gracias por tu solicitud para agendar una nueva fecha. Revisaremos la disponibilidad y te contactaremos pronto a <span id="confirm-request-email" class="fw-bold">tu email</span>.</p>
                    <p>Solicitaste:</p>
                    <p><strong id="confirm-request-details">Experiencia - Fecha - Hora</strong></p>
                    {/* Go back to the very first step */}
                    <button class="btn btn-primary mt-4" onclick="goToStep('step-q1GJ')">Volver al Inicio</button>
                </div>
             </div>


            {/* --- Other Existing Steps --- */}
            <div id="step-bSoz" class="form-step d-none">...</div>
            <div id="step-2sff" class="form-step d-none">...</div>
            <div id="step-qf5J" class="form-step d-none">...</div>
            <div id="step-checkout-placeholder" class="form-step d-none">...</div>
            <div id="step-gr5a" class="form-step d-none">...</div>
            <div id="subform-group-config" class="form-step d-none">...</div>
            <div id="subform-scheduling" class="form-step d-none">...</div>


        </div> </div> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    {/* Added Flatpickr JS */}
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/es.js"></script> {/* Spanish locale for Flatpickr */}
    <script src="js/script.js"></script>
</body>
</html>